---
description: "Laravel 12 with React and Inertia.js patterns and best practices. Covers controller patterns, data validation, Inertia responses, React component structure, and shared data handling."
alwaysApply: false
---

# Laravel 12 + React + Inertia Patterns

## Stack Overview

- **Backend:** Laravel 12.x
- **Frontend:** React 18+
- **Bridge:** Inertia.js 2.x
- **Styling:** TailwindCSS (assumed)

## Controller Patterns

### Inertia Responses

```php
use Inertia\Inertia;

// ✅ CORRECT - Return Inertia response
public function index()
{
    $posts = Post::with('author', 'tags')
        ->latest()
        ->paginate(15);
    
    return Inertia::render('Posts/Index', [
        'posts' => $posts,
        'filters' => request()->only(['search', 'status']),
    ]);
}

// ✅ CORRECT - Return with flash messages
public function store(StorePostRequest $request)
{
    try {
        DB::transaction(function () use ($request) {
            $post = Post::create($request->validated());
            $post->tags()->sync($request->tags);
        });
        
        return redirect()->route('posts.index')
            ->with('success', 'Post created successfully');
            
    } catch (\Exception $e) {
        Log::error('Failed to create post', [
            'error' => $e->getMessage(),
            'trace' => $e->getTraceAsString(),
        ]);
        
        return back()
            ->with('error', 'Failed to create post')
            ->withInput();
    }
}

// ❌ WRONG - Returning JSON instead of Inertia
public function index()
{
    return response()->json(['posts' => Post::all()]);
}
```

### Resource Transformations

Use API Resources for consistent data structure:

```php
use App\Http\Resources\PostResource;

// ✅ CORRECT - Use resource collections
public function index()
{
    $posts = Post::latest()->paginate(15);
    
    return Inertia::render('Posts/Index', [
        'posts' => PostResource::collection($posts),
    ]);
}

// ✅ CORRECT - Single resource
public function show(Post $post)
{
    return Inertia::render('Posts/Show', [
        'post' => new PostResource($post->load('author', 'tags', 'comments')),
    ]);
}
```

### Form Requests

Always use Form Requests for validation:

```php
// ✅ CORRECT - Dedicated form request
class StorePostRequest extends FormRequest
{
    public function authorize(): bool
    {
        return $this->user()->can('create', Post::class);
    }

    public function rules(): array
    {
        return [
            'title' => 'required|string|max:255',
            'content' => 'required|string',
            'published_at' => 'nullable|date',
            'tags' => 'nullable|array',
            'tags.*' => 'exists:tags,id',
        ];
    }

    public function messages(): array
    {
        return [
            'title.required' => 'O título é obrigatório.',
            'content.required' => 'O conteúdo é obrigatório.',
        ];
    }
}

// Usage in controller
public function store(StorePostRequest $request)
{
    // Validation already passed
    $post = Post::create($request->validated());
}
```

## React Component Patterns

### Page Component Structure

```tsx
// resources/js/Pages/Posts/Index.tsx

import { Head, Link, router } from '@inertiajs/react';
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout';
import { Post, PageProps, PaginatedData } from '@/types';

interface Props extends PageProps {
    posts: PaginatedData<Post>;
    filters: {
        search?: string;
        status?: string;
    };
}

export default function Index({ auth, posts, filters }: Props) {
    // ✅ CORRECT - Type-safe props with interfaces
    
    const handleSearch = (search: string) => {
        router.get(route('posts.index'), 
            { search, status: filters.status },
            { preserveState: true, replace: true }
        );
    };
    
    return (
        <AuthenticatedLayout user={auth.user}>
            <Head title="Posts" />
            
            <div className="py-12">
                <div className="max-w-7xl mx-auto sm:px-6 lg:px-8">
                    {/* Component content */}
                </div>
            </div>
        </AuthenticatedLayout>
    );
}
```

### Form Handling with useForm

```tsx
// resources/js/Pages/Posts/Create.tsx

import { useForm, Head } from '@inertiajs/react';
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout';
import InputError from '@/Components/InputError';
import InputLabel from '@/Components/InputLabel';
import PrimaryButton from '@/Components/PrimaryButton';
import TextInput from '@/Components/TextInput';

export default function Create({ auth }) {
    // ✅ CORRECT - Inertia's useForm hook
    const { data, setData, post, processing, errors, reset } = useForm({
        title: '',
        content: '',
        published_at: '',
        tags: [],
    });

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        
        post(route('posts.store'), {
            onSuccess: () => reset(),
            onError: () => {
                // Form stays populated with errors
            },
        });
    };

    return (
        <AuthenticatedLayout user={auth.user}>
            <Head title="Create Post" />
            
            <form onSubmit={handleSubmit} className="max-w-4xl mx-auto">
                <div className="mb-4">
                    <InputLabel htmlFor="title" value="Title" />
                    
                    <TextInput
                        id="title"
                        type="text"
                        value={data.title}
                        onChange={(e) => setData('title', e.target.value)}
                        className="mt-1 block w-full"
                    />
                    
                    <InputError message={errors.title} className="mt-2" />
                </div>

                <div className="mb-4">
                    <InputLabel htmlFor="content" value="Content" />
                    
                    <textarea
                        id="content"
                        value={data.content}
                        onChange={(e) => setData('content', e.target.value)}
                        className="mt-1 block w-full rounded-md border-gray-300"
                        rows={10}
                    />
                    
                    <InputError message={errors.content} className="mt-2" />
                </div>

                <PrimaryButton disabled={processing}>
                    {processing ? 'Creating...' : 'Create Post'}
                </PrimaryButton>
            </form>
        </AuthenticatedLayout>
    );
}
```

### Reusable Components

```tsx
// resources/js/Components/PostCard.tsx

import { Link } from '@inertiajs/react';
import { Post } from '@/types';

interface PostCardProps {
    post: Post;
    onDelete?: (id: number) => void;
}

export default function PostCard({ post, onDelete }: PostCardProps) {
    return (
        <div className="bg-white rounded-lg shadow-md p-6">
            <h3 className="text-xl font-semibold mb-2">
                <Link 
                    href={route('posts.show', post.id)}
                    className="hover:text-blue-600"
                >
                    {post.title}
                </Link>
            </h3>
            
            <p className="text-gray-600 mb-4">
                {post.excerpt}
            </p>
            
            <div className="flex items-center justify-between">
                <span className="text-sm text-gray-500">
                    {post.published_at_formatted}
                </span>
                
                {onDelete && (
                    <button
                        onClick={() => onDelete(post.id)}
                        className="text-red-600 hover:text-red-800"
                    >
                        Delete
                    </button>
                )}
            </div>
        </div>
    );
}
```

## Type Definitions

```typescript
// resources/js/types/index.d.ts

export interface User {
    id: number;
    name: string;
    email: string;
    email_verified_at?: string;
}

export interface Post {
    id: number;
    title: string;
    content: string;
    excerpt: string;
    published_at: string | null;
    published_at_formatted: string;
    author: User;
    tags: Tag[];
    created_at: string;
    updated_at: string;
}

export interface Tag {
    id: number;
    name: string;
    slug: string;
}

export interface PaginatedData<T> {
    data: T[];
    current_page: number;
    last_page: number;
    per_page: number;
    total: number;
    links: {
        url: string | null;
        label: string;
        active: boolean;
    }[];
}

export interface PageProps {
    auth: {
        user: User;
    };
    flash?: {
        success?: string;
        error?: string;
    };
}
```

## Shared Data Handling

### HandleInertiaRequests Middleware

```php
// app/Http/Middleware/HandleInertiaRequests.php

public function share(Request $request): array
{
    return [
        ...parent::share($request),
        
        // ✅ CORRECT - Share auth user
        'auth' => [
            'user' => $request->user() ? [
                'id' => $request->user()->id,
                'name' => $request->user()->name,
                'email' => $request->user()->email,
                'permissions' => $request->user()->permissions,
            ] : null,
        ],
        
        // ✅ CORRECT - Share flash messages
        'flash' => [
            'success' => fn () => $request->session()->get('success'),
            'error' => fn () => $request->session()->get('error'),
        ],
        
        // ✅ CORRECT - Share app config
        'app' => [
            'name' => config('app.name'),
            'locale' => app()->getLocale(),
        ],
    ];
}
```

### Using Shared Data in React

```tsx
import { usePage } from '@inertiajs/react';
import { PageProps } from '@/types';

export default function Component() {
    const { auth, flash, app } = usePage<PageProps>().props;
    
    // Access shared data
    const user = auth.user;
    const successMessage = flash?.success;
    const appName = app.name;
    
    return (
        <div>
            {successMessage && (
                <div className="bg-green-100 p-4 rounded">
                    {successMessage}
                </div>
            )}
        </div>
    );
}
```

## Navigation and Routing

```tsx
import { Link, router } from '@inertiajs/react';

// ✅ CORRECT - Using Link component
<Link 
    href={route('posts.show', post.id)}
    className="text-blue-600 hover:underline"
>
    View Post
</Link>

// ✅ CORRECT - Programmatic navigation
router.visit(route('posts.index'));

// ✅ CORRECT - Form submission with redirect
router.post(route('posts.store'), data, {
    onSuccess: () => {
        router.visit(route('posts.index'));
    },
});

// ✅ CORRECT - DELETE with confirmation
const handleDelete = (id: number) => {
    if (confirm('Are you sure?')) {
        router.delete(route('posts.destroy', id), {
            preserveScroll: true,
        });
    }
};
```

## Pagination

```tsx
import { Link } from '@inertiajs/react';
import { PaginatedData, Post } from '@/types';

interface Props {
    posts: PaginatedData<Post>;
}

export default function PostsList({ posts }: Props) {
    return (
        <div>
            {/* Posts list */}
            {posts.data.map(post => (
                <PostCard key={post.id} post={post} />
            ))}
            
            {/* ✅ CORRECT - Inertia pagination */}
            <div className="flex gap-1 mt-8">
                {posts.links.map((link, index) => (
                    <Link
                        key={index}
                        href={link.url || '#'}
                        className={`px-4 py-2 rounded ${
                            link.active 
                                ? 'bg-blue-600 text-white' 
                                : 'bg-gray-200'
                        }`}
                        preserveState
                        preserveScroll
                        dangerouslySetInnerHTML={{ __html: link.label }}
                    />
                ))}
            </div>
        </div>
    );
}
```

## File Uploads

```tsx
import { useForm } from '@inertiajs/react';

export default function CreatePost() {
    const { data, setData, post, errors, progress } = useForm({
        title: '',
        image: null as File | null,
    });

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        
        // ✅ CORRECT - File upload with Inertia
        post(route('posts.store'), {
            forceFormData: true, // Important for file uploads
            onProgress: () => {
                // Track upload progress
            },
        });
    };

    return (
        <form onSubmit={handleSubmit}>
            <input
                type="file"
                onChange={(e) => setData('image', e.target.files?.[0] || null)}
                accept="image/*"
            />
            
            {progress && (
                <div className="w-full bg-gray-200 rounded">
                    <div 
                        className="bg-blue-600 h-2 rounded"
                        style={{ width: `${progress.percentage}%` }}
                    />
                </div>
            )}
            
            <button type="submit">Upload</button>
        </form>
    );
}
```

## Best Practices Summary

### Backend (Laravel)
1. Use Form Requests for validation
2. Return Inertia responses, not JSON
3. Use API Resources for data transformation
4. Share common data via middleware
5. Handle flash messages properly

### Frontend (React)
1. Define TypeScript interfaces for all props
2. Use Inertia's useForm hook for forms
3. Extract reusable components
4. Use Link component for navigation
5. Handle loading states with `processing`
6. Display validation errors properly

### Data Flow
1. Controller → API Resource → Inertia::render() → React Props
2. Form submission → useForm → route() → Controller → Redirect
3. Flash messages → Middleware → Shared props → React components

### Common Pitfalls to Avoid

```tsx
// ❌ WRONG - Direct axios/fetch calls (breaks Inertia SPA)
axios.post('/posts', data);

// ✅ CORRECT - Use Inertia router
router.post(route('posts.store'), data);

// ❌ WRONG - Full page reload
window.location.href = '/posts';

// ✅ CORRECT - SPA navigation
router.visit(route('posts.index'));

// ❌ WRONG - Untyped props
export default function Index({ posts }) {

// ✅ CORRECT - Typed props
export default function Index({ posts }: { posts: PaginatedData<Post> }) {
```
